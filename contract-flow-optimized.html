<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Membership Signup (Experimental) - Payment Test Bench</title>

    <!-- TailwindCSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Inter', sans-serif;
        }

        /* Screen transitions */
        .screen {
            animation: fadeIn 0.3s ease-in;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Offer card styles */
        .offer-card {
            transition: all 0.2s ease;
            cursor: pointer;
        }

        .offer-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }

        .offer-card.selected {
            border-color: #3B82F6;
            background-color: rgba(59, 130, 246, 0.05);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
        }

        /* Contract Summary sticky panel */
        .order-summary-panel {
            position: sticky;
            top: 5rem;
            max-height: calc(100vh - 6rem);
            overflow-y: auto;
        }

        /* Skeleton loader */
        .skeleton {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
        }

        @keyframes loading {
            0% {
                background-position: 200% 0;
            }
            100% {
                background-position: -200% 0;
            }
        }

        /* Chip/Badge styles */
        .chip {
            display: inline-flex;
            align-items: center;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.875rem;
            font-weight: 500;
        }

        .chip-success {
            background-color: #DEF7EC;
            color: #03543F;
        }

        .chip-warning {
            background-color: #FEF3C7;
            color: #92400E;
        }

        .chip-error {
            background-color: #FDE8E8;
            color: #991B1B;
        }

        .chip-info {
            background-color: #E1EFFE;
            color: #1E40AF;
        }

        /* Button spinner */
        .btn-spinner {
            border: 2px solid #ffffff;
            border-top: 2px solid transparent;
            border-radius: 50%;
            width: 16px;
            height: 16px;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Progress dots */
        .progress-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background-color: #D1D5DB;
            transition: all 0.3s;
        }

        .progress-dot.active {
            width: 24px;
            border-radius: 4px;
            background-color: #3B82F6;
        }

        .progress-dot.completed {
            background-color: #10B981;
        }

        /* Input focus styles */
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #3B82F6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        /* Error state */
        .error-input {
            border-color: #EF4444 !important;
        }

        /* Hidden utility */
        .hidden {
            display: none !important;
        }

        /* Mobile contract summary slide-up */
        @media (max-width: 768px) {
            .order-summary-mobile {
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                max-height: 60vh;
                overflow-y: auto;
                z-index: 40;
                transform: translateY(calc(100% - 60px));
                transition: transform 0.3s ease;
                box-shadow: 0 -4px 6px rgba(0, 0, 0, 0.1);
            }

            .order-summary-mobile.expanded {
                transform: translateY(0);
            }

            .order-summary-panel {
                position: relative;
                top: 0;
                max-height: none;
            }
        }

        /* Best value badge */
        .best-value-badge {
            position: absolute;
            top: -10px;
            right: -10px;
            background: linear-gradient(135deg, #F59E0B, #EF4444);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.8;
            }
        }
    </style>
</head>
<body class="bg-gray-50">

    <!-- Navigation will be injected by nav.js -->

    <!-- Main Container -->
    <main class="pt-20 pb-8">
        <!-- Progress Indicator (Mobile) -->
        <div class="md:hidden fixed top-16 left-0 right-0 bg-white border-b border-gray-200 py-3 px-4 z-30">
            <div class="flex items-center justify-center space-x-2">
                <div class="progress-dot active" data-screen="A"></div>
                <div class="progress-dot" data-screen="B"></div>
                <div class="progress-dot" data-screen="C"></div>
                <div class="progress-dot" data-screen="D"></div>
            </div>
            <div class="text-center text-sm font-medium text-gray-700 mt-2" id="current-screen-label">
                Choose Your Plan
            </div>
        </div>

        <div class="container mx-auto px-4 max-w-7xl mt-8 md:mt-0">

            <!-- ========================================
                 SCREEN A: CHOOSE PLAN
                 ======================================== -->
            <div id="screen-A" class="screen" data-screen="A">
                <div class="max-w-6xl mx-auto">
                    <!-- Header -->
                    <div class="text-center mb-12">
                        <h1 class="text-4xl md:text-5xl font-bold text-gray-900 mb-4">
                            Choose Your Membership
                        </h1>
                        <p class="text-lg text-gray-600">
                            Select the plan that best fits your needs
                        </p>
                    </div>

                    <!-- Loading State -->
                    <div id="offers-loading" class="flex flex-col items-center justify-center py-20">
                        <div class="animate-spin rounded-full h-16 w-16 border-b-4 border-blue-600 mb-4"></div>
                        <p class="text-gray-600 font-medium">Loading offers...</p>
                    </div>

                    <!-- Error State -->
                    <div id="offers-error" class="hidden max-w-2xl mx-auto">
                        <div class="bg-red-50 border-2 border-red-200 rounded-lg p-6 text-center">
                            <svg class="w-12 h-12 text-red-600 mx-auto mb-4" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"/>
                            </svg>
                            <h3 class="text-lg font-bold text-red-900 mb-2">Failed to Load Offers</h3>
                            <p class="text-red-700 mb-4" id="offers-error-message"></p>
                            <button id="retry-offers" class="px-6 py-3 bg-red-600 text-white rounded-lg hover:bg-red-700 transition font-medium">
                                Try Again
                            </button>
                        </div>
                    </div>

                    <!-- Offers Grid -->
                    <div id="offers-grid" class="hidden grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
                        <!-- Offer cards will be dynamically inserted here -->
                    </div>

                    <!-- Continue Button -->
                    <div id="offers-continue-container" class="hidden max-w-2xl mx-auto text-center mt-12">
                        <button id="continue-screen-A" class="px-8 py-4 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition font-semibold text-lg shadow-lg disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                            Continue to Your Details →
                        </button>
                    </div>
                </div>
            </div>

            <!-- ========================================
                 SCREEN B: YOUR DETAILS + CONTRACT SUMMARY
                 ======================================== -->
            <div id="screen-B" class="screen hidden" data-screen="B">
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    <!-- Left: Form (2/3) -->
                    <div class="lg:col-span-2">
                        <h1 class="text-3xl md:text-4xl font-bold text-gray-900 mb-2">Your Details</h1>
                        <p class="text-gray-600 mb-8">Please provide your information</p>

                        <form id="details-form" class="space-y-6">
                            <!-- Personal Details -->
                            <div class="bg-white rounded-lg border border-gray-200 p-6 shadow-sm">
                                <div class="flex items-center justify-between mb-6">
                                    <h2 class="text-xl font-bold text-gray-900">Personal Information</h2>
                                    <button type="button" id="fill-test-data-btn" class="px-3 py-1.5 text-sm font-medium text-blue-600 bg-blue-50 hover:bg-blue-100 rounded-md transition">
                                        Fill Test Data
                                    </button>
                                </div>

                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label for="firstName" class="block text-sm font-medium text-gray-700 mb-1">
                                            First Name <span class="text-red-500">*</span>
                                        </label>
                                        <input type="text" id="firstName" name="firstName" required
                                               class="w-full border border-gray-300 rounded-md px-4 py-2.5 transition"
                                               placeholder="John">
                                        <p class="text-red-600 text-sm mt-1 hidden error-message"></p>
                                    </div>

                                    <div>
                                        <label for="lastName" class="block text-sm font-medium text-gray-700 mb-1">
                                            Last Name <span class="text-red-500">*</span>
                                        </label>
                                        <input type="text" id="lastName" name="lastName" required
                                               class="w-full border border-gray-300 rounded-md px-4 py-2.5 transition"
                                               placeholder="Doe">
                                        <p class="text-red-600 text-sm mt-1 hidden error-message"></p>
                                    </div>
                                </div>

                                <div class="mt-4">
                                    <label for="email" class="block text-sm font-medium text-gray-700 mb-1">
                                        Email Address <span class="text-red-500">*</span>
                                    </label>
                                    <input type="email" id="email" name="email" required
                                           class="w-full border border-gray-300 rounded-md px-4 py-2.5 transition"
                                           placeholder="john.doe@example.com">
                                    <p class="text-red-600 text-sm mt-1 hidden error-message"></p>
                                </div>

                                <div class="mt-4">
                                    <label for="dateOfBirth" class="block text-sm font-medium text-gray-700 mb-1">
                                        Date of Birth <span class="text-red-500">*</span>
                                    </label>
                                    <input type="date" id="dateOfBirth" name="dateOfBirth" required
                                           class="w-full border border-gray-300 rounded-md px-4 py-2.5 transition">
                                    <p class="text-sm text-gray-500 mt-1">You must be at least 16 years old</p>
                                    <div id="age-discount-badge" class="hidden mt-2">
                                        <!-- Age discount badge will appear here -->
                                    </div>
                                    <p class="text-red-600 text-sm mt-1 hidden error-message"></p>
                                </div>

                                <div class="mt-4">
                                    <label for="phone" class="block text-sm font-medium text-gray-700 mb-1">
                                        Phone Number (Optional)
                                    </label>
                                    <input type="tel" id="phone" name="phone"
                                           class="w-full border border-gray-300 rounded-md px-4 py-2.5 transition"
                                           placeholder="+49 123 456 789">
                                </div>
                            </div>

                            <!-- Address -->
                            <div class="bg-white rounded-lg border border-gray-200 p-6 shadow-sm">
                                <h2 class="text-xl font-bold text-gray-900 mb-6">Address</h2>

                                <div class="mb-4">
                                    <label for="street" class="block text-sm font-medium text-gray-700 mb-1">
                                        Street Address <span class="text-red-500">*</span>
                                    </label>
                                    <input type="text" id="street" name="street" required
                                           class="w-full border border-gray-300 rounded-md px-4 py-2.5 transition"
                                           placeholder="123 Main St">
                                    <p class="text-red-600 text-sm mt-1 hidden error-message"></p>
                                </div>

                                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                    <div class="md:col-span-2">
                                        <label for="city" class="block text-sm font-medium text-gray-700 mb-1">
                                            City <span class="text-red-500">*</span>
                                        </label>
                                        <input type="text" id="city" name="city" required
                                               class="w-full border border-gray-300 rounded-md px-4 py-2.5 transition"
                                               placeholder="Berlin">
                                        <p class="text-red-600 text-sm mt-1 hidden error-message"></p>
                                    </div>

                                    <div>
                                        <label for="zipCode" class="block text-sm font-medium text-gray-700 mb-1">
                                            Postal Code <span class="text-red-500">*</span>
                                        </label>
                                        <input type="text" id="zipCode" name="zipCode" required
                                               class="w-full border border-gray-300 rounded-md px-4 py-2.5 transition"
                                               placeholder="10115">
                                        <p class="text-red-600 text-sm mt-1 hidden error-message"></p>
                                    </div>
                                </div>

                                <div class="mt-4">
                                    <label for="countryCode" class="block text-sm font-medium text-gray-700 mb-1">
                                        Country <span class="text-red-500">*</span>
                                    </label>
                                    <select id="countryCode" name="countryCode" required
                                            class="w-full border border-gray-300 rounded-md px-4 py-2.5 transition">
                                        <option value="">Select a country</option>
                                        <option value="DE">Germany</option>
                                        <option value="AT">Austria</option>
                                        <option value="CH">Switzerland</option>
                                        <option value="FR">France</option>
                                        <option value="IT">Italy</option>
                                        <option value="ES">Spain</option>
                                        <option value="NL">Netherlands</option>
                                        <option value="BE">Belgium</option>
                                        <option value="GB">United Kingdom</option>
                                        <option value="US">United States</option>
                                    </select>
                                    <p class="text-red-600 text-sm mt-1 hidden error-message"></p>
                                </div>
                            </div>

                            <!-- Contract Options -->
                            <div class="bg-white rounded-lg border border-gray-200 p-6 shadow-sm">
                                <h2 class="text-xl font-bold text-gray-900 mb-6">Contract Options</h2>

                                <div class="mb-4">
                                    <label for="startDate" class="block text-sm font-medium text-gray-700 mb-1">
                                        Start Date <span class="text-red-500">*</span>
                                    </label>
                                    <input type="date" id="startDate" name="startDate" required
                                           class="w-full border border-gray-300 rounded-md px-4 py-2.5 transition">
                                    <p class="text-sm text-gray-500 mt-1">Your membership will begin on this date</p>
                                </div>

                                <div>
                                    <label for="voucherCode" class="block text-sm font-medium text-gray-700 mb-1">
                                        Voucher Code (Optional)
                                    </label>
                                    <div class="flex gap-3">
                                        <input type="text" id="voucherCode" name="voucherCode"
                                               class="flex-1 border border-gray-300 rounded-md px-4 py-2.5 transition"
                                               placeholder="Enter code">
                                        <button type="button" id="apply-voucher-btn" class="px-6 py-2.5 bg-green-600 text-white rounded-md hover:bg-green-700 transition font-medium">
                                            Apply
                                        </button>
                                    </div>
                                    <div id="voucher-feedback" class="mt-2">
                                        <!-- Voucher chips will appear here -->
                                    </div>
                                </div>
                            </div>

                            <!-- Navigation -->
                            <div class="flex justify-between items-center pt-4">
                                <button type="button" id="back-screen-B" class="px-6 py-3 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition font-medium">
                                    ← Back to Plans
                                </button>
                                <button type="submit" id="continue-screen-B" class="px-8 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition font-semibold disabled:opacity-50 disabled:cursor-not-allowed">
                                    Continue to Payment →
                                </button>
                            </div>
                        </form>
                    </div>

                    <!-- Right: Contract Summary (1/3) - Sticky on desktop -->
                    <div class="lg:col-span-1">
                        <div class="order-summary-panel">
                            <div id="order-summary" class="bg-white rounded-lg border-2 border-blue-200 p-6 shadow-lg">
                                <h2 class="text-xl font-bold text-gray-900 mb-6">Contract Summary</h2>

                                <!-- Content will be dynamically updated -->
                                <div id="order-summary-content">
                                    <!-- Skeleton loader initially -->
                                    <div class="space-y-4">
                                        <div class="skeleton h-6 rounded"></div>
                                        <div class="skeleton h-4 rounded w-3/4"></div>
                                        <div class="skeleton h-4 rounded w-1/2"></div>
                                        <div class="border-t border-gray-200 my-4"></div>
                                        <div class="skeleton h-8 rounded"></div>
                                        <div class="skeleton h-6 rounded w-2/3"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ========================================
                 SCREEN C: PAYMENT
                 ======================================== -->
            <div id="screen-C" class="screen hidden" data-screen="C">
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    <!-- Left: Payment Form (2/3) -->
                    <div class="lg:col-span-2">
                        <h1 class="text-3xl md:text-4xl font-bold text-gray-900 mb-2">Payment Setup</h1>
                        <p class="text-gray-600 mb-8">Set up your payment methods</p>

                        <!-- Step 1: Recurring Payment -->
                        <div id="recurring-payment-section" class="bg-white rounded-lg border border-gray-200 p-6 shadow-sm mb-6">
                            <div class="flex items-center justify-between mb-4">
                                <div>
                                    <h2 class="text-xl font-bold text-gray-900">Step 1: Recurring Payment Method</h2>
                                    <p class="text-sm text-gray-600 mt-1">Set up payment for your monthly membership fees</p>
                                </div>
                                <div id="recurring-status-badge" class="hidden">
                                    <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-semibold bg-green-100 text-green-800">
                                        <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 20 20">
                                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                                        </svg>
                                        Complete
                                    </span>
                                </div>
                            </div>

                            <div class="flex items-center space-x-2 mb-6 text-gray-600 text-sm">
                                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z" clip-rule="evenodd"/>
                                </svg>
                                <span>Secure payment • We never store your full card details</span>
                            </div>

                            <!-- Recurring Payment Widget Container -->
                            <div id="recurring-payment-container" class="min-h-[400px]">
                                <!-- Recurring payment widget will be mounted here -->
                            </div>

                            <!-- Recurring Payment Loading -->
                            <div id="recurring-payment-loading" class="flex flex-col items-center justify-center py-20">
                                <div class="animate-spin rounded-full h-16 w-16 border-b-4 border-blue-600 mb-4"></div>
                                <p class="text-gray-600 font-medium">Loading payment options...</p>
                            </div>

                            <!-- Recurring Payment Error -->
                            <div id="recurring-payment-error" class="hidden bg-red-50 border-2 border-red-200 rounded-lg p-6">
                                <div class="flex items-start">
                                    <svg class="w-6 h-6 text-red-600 mr-3 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"/>
                                    </svg>
                                    <div class="flex-1">
                                        <h3 class="text-lg font-bold text-red-900 mb-1">Payment Error</h3>
                                        <p class="text-red-700" id="recurring-payment-error-message"></p>
                                        <button id="retry-recurring-payment" class="mt-3 px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 transition font-medium">
                                            Try Again
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- Recurring Payment Success -->
                            <div id="recurring-payment-success" class="hidden bg-green-50 border-2 border-green-200 rounded-lg p-4">
                                <div class="flex items-center text-green-700">
                                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                                    </svg>
                                    <span class="font-semibold">Recurring payment method saved!</span>
                                </div>
                            </div>
                        </div>

                        <!-- Step 2: Upfront Payment -->
                        <div id="upfront-payment-section" class="bg-white rounded-lg border border-gray-200 p-6 shadow-sm mb-6 hidden">
                            <div class="flex items-center justify-between mb-4">
                                <div>
                                    <h2 class="text-xl font-bold text-gray-900">Step 2: Upfront Payment</h2>
                                    <p class="text-sm text-gray-600 mt-1">Pay <span id="upfront-amount-display" class="font-semibold"></span> today</p>
                                </div>
                                <div id="upfront-status-badge" class="hidden">
                                    <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-semibold bg-green-100 text-green-800">
                                        <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 20 20">
                                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                                        </svg>
                                        Complete
                                    </span>
                                </div>
                            </div>

                            <div class="flex items-center space-x-2 mb-6 text-gray-600 text-sm">
                                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z" clip-rule="evenodd"/>
                                </svg>
                                <span>Secure payment • We never store your full card details</span>
                            </div>

                            <!-- Upfront Payment Widget Container -->
                            <div id="upfront-payment-container" class="min-h-[400px]">
                                <!-- Upfront payment widget will be mounted here -->
                            </div>

                            <!-- Upfront Payment Loading -->
                            <div id="upfront-payment-loading" class="flex flex-col items-center justify-center py-20">
                                <div class="animate-spin rounded-full h-16 w-16 border-b-4 border-green-600 mb-4"></div>
                                <p class="text-gray-600 font-medium">Processing payment...</p>
                            </div>

                            <!-- Upfront Payment Error -->
                            <div id="upfront-payment-error" class="hidden bg-red-50 border-2 border-red-200 rounded-lg p-6">
                                <div class="flex items-start">
                                    <svg class="w-6 h-6 text-red-600 mr-3 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"/>
                                    </svg>
                                    <div class="flex-1">
                                        <h3 class="text-lg font-bold text-red-900 mb-1">Payment Error</h3>
                                        <p class="text-red-700" id="upfront-payment-error-message"></p>
                                        <button id="retry-upfront-payment" class="mt-3 px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 transition font-medium">
                                            Try Again
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- Upfront Payment Success -->
                            <div id="upfront-payment-success" class="hidden bg-green-50 border-2 border-green-200 rounded-lg p-4">
                                <div class="flex items-center text-green-700">
                                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                                    </svg>
                                    <span class="font-semibold">Payment completed successfully!</span>
                                </div>
                            </div>
                        </div>

                        <!-- Navigation -->
                        <div class="flex justify-between items-center mt-8">
                            <button type="button" id="back-screen-C" class="px-6 py-3 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition font-medium">
                                ← Back to Details
                            </button>
                            <button type="button" id="continue-screen-C" class="px-8 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition font-semibold disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                                Continue to Review →
                            </button>
                        </div>
                    </div>

                    <!-- Right: Contract Summary (1/3) -->
                    <div class="lg:col-span-1">
                        <div class="order-summary-panel">
                            <div class="bg-white rounded-lg border-2 border-blue-200 p-6 shadow-lg">
                                <h2 class="text-xl font-bold text-gray-900 mb-6">Contract Summary</h2>
                                <div id="order-summary-payment">
                                    <!-- Same content as Screen B -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ========================================
                 SCREEN D: REVIEW & SIGN
                 ======================================== -->
            <div id="screen-D" class="screen hidden" data-screen="D">
                <div class="max-w-4xl mx-auto">
                    <h1 class="text-3xl md:text-4xl font-bold text-gray-900 mb-2">Review & Confirm</h1>
                    <p class="text-gray-600 mb-8">Please review your information before completing signup</p>

                    <!-- Member Info -->
                    <div class="bg-white rounded-lg border border-gray-200 p-6 shadow-sm mb-6">
                        <div class="flex items-center justify-between mb-4">
                            <h2 class="text-xl font-bold text-gray-900">Member Information</h2>
                            <button type="button" id="edit-member-info" class="text-blue-600 hover:text-blue-700 font-medium text-sm">
                                Change
                            </button>
                        </div>
                        <div id="review-member-info" class="space-y-2 text-gray-700">
                            <!-- Will be populated dynamically -->
                        </div>
                    </div>

                    <!-- Membership Details -->
                    <div class="bg-white rounded-lg border border-gray-200 p-6 shadow-sm mb-6">
                        <div class="flex items-center justify-between mb-4">
                            <h2 class="text-xl font-bold text-gray-900">Membership Details</h2>
                            <button type="button" id="edit-membership" class="text-blue-600 hover:text-blue-700 font-medium text-sm">
                                Change
                            </button>
                        </div>
                        <div id="review-membership-info" class="space-y-2 text-gray-700">
                            <!-- Will be populated dynamically -->
                        </div>
                    </div>

                    <!-- Payment Summary -->
                    <div class="bg-gradient-to-r from-blue-50 to-blue-100 rounded-lg border-2 border-blue-300 p-6 shadow-sm mb-6">
                        <h2 class="text-xl font-bold text-gray-900 mb-4">Payment Summary</h2>
                        <div id="review-payment-summary" class="space-y-3">
                            <!-- Will be populated dynamically -->
                        </div>
                    </div>

                    <!-- Terms & Conditions -->
                    <div class="bg-white rounded-lg border border-gray-200 p-6 shadow-sm mb-6">
                        <label class="flex items-start cursor-pointer">
                            <input type="checkbox" id="accept-terms" class="mt-1 mr-3 h-5 w-5 text-blue-600 border-gray-300 rounded focus:ring-blue-500">
                            <span class="text-gray-700">
                                I accept the <a href="#" class="text-blue-600 hover:underline font-medium">Terms & Conditions</a>
                                and <a href="#" class="text-blue-600 hover:underline font-medium">Privacy Policy</a>
                            </span>
                        </label>
                    </div>

                    <!-- Signature Pad (if required) -->
                    <div id="signature-container" class="hidden bg-white rounded-lg border border-gray-200 p-6 shadow-sm mb-6">
                        <h2 class="text-xl font-bold text-gray-900 mb-4">Signature</h2>
                        <canvas id="signature-pad" class="border-2 border-gray-300 rounded-lg w-full h-40"></canvas>
                        <button type="button" id="clear-signature" class="mt-2 text-sm text-gray-600 hover:text-gray-800">
                            Clear Signature
                        </button>
                    </div>

                    <!-- Submit Loading -->
                    <div id="submit-loading" class="hidden bg-blue-50 border-2 border-blue-200 rounded-lg p-8 text-center mb-6">
                        <div class="inline-block animate-spin rounded-full h-16 w-16 border-b-4 border-blue-600 mb-4"></div>
                        <p class="text-gray-900 font-bold text-lg">Creating your membership...</p>
                        <p class="text-gray-600 text-sm mt-2">Please do not close this window</p>
                    </div>

                    <!-- Submit Error -->
                    <div id="submit-error" class="hidden bg-red-50 border-2 border-red-200 rounded-lg p-6 mb-6">
                        <div class="flex items-start">
                            <svg class="w-6 h-6 text-red-600 mr-3 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"/>
                            </svg>
                            <div class="flex-1">
                                <h3 class="text-lg font-bold text-red-900 mb-1">Signup Failed</h3>
                                <p class="text-red-700" id="submit-error-message"></p>
                                <button id="retry-submit" class="mt-3 px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 transition font-medium">
                                    Try Again
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Submit Success -->
                    <div id="submit-success" class="hidden bg-green-50 border-2 border-green-200 rounded-lg p-8 text-center mb-6">
                        <div class="inline-flex items-center justify-center w-20 h-20 rounded-full bg-green-100 mb-4">
                            <svg class="w-12 h-12 text-green-600" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                            </svg>
                        </div>
                        <h3 class="text-3xl font-bold text-green-900 mb-2">Membership Created!</h3>
                        <p class="text-gray-700 mb-4">Your membership has been successfully activated.</p>
                        <p class="text-gray-600 text-sm mb-6">
                            Customer ID: <span id="customer-id" class="font-mono font-bold text-gray-900"></span>
                        </p>
                        <button id="create-another" class="px-8 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition font-semibold shadow-lg">
                            Create Another Membership
                        </button>
                    </div>

                    <!-- Navigation -->
                    <div id="review-navigation" class="flex justify-between items-center">
                        <button type="button" id="back-screen-D" class="px-6 py-3 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition font-medium">
                            ← Back to Payment
                        </button>
                        <button type="button" id="submit-contract" class="px-10 py-4 bg-gradient-to-r from-blue-600 to-blue-700 text-white rounded-lg hover:from-blue-700 hover:to-blue-800 transition font-bold text-lg shadow-lg disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                            Complete Signup
                        </button>
                    </div>
                </div>
            </div>

        </div>
    </main>

    <!-- Mobile Contract Summary Toggle (only visible on mobile on Screen B & C) -->
    <div id="mobile-summary-toggle" class="md:hidden fixed bottom-0 left-0 right-0 bg-white border-t-2 border-blue-200 p-4 z-40 hidden">
        <button id="toggle-summary-btn" class="w-full flex items-center justify-between text-left">
            <span class="font-bold text-gray-900">Contract Summary</span>
            <svg class="w-5 h-5 transform transition-transform" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M14.707 12.707a1 1 0 01-1.414 0L10 9.414l-3.293 3.293a1 1 0 01-1.414-1.414l4-4a1 1 0 011.414 0l4 4a1 1 0 010 1.414z" clip-rule="evenodd"/>
            </svg>
        </button>
    </div>

    <!-- Payment Widget Script -->
    <script src="https://widget.dev.payment.sportalliance.com/widget.js"></script>

    <!-- Config -->
    <script src="config.js"></script>

    <!-- Navigation -->
    <script src="nav.js"></script>
    <script>
        Navigation.init('contract-flow-optimized');
        document.addEventListener('DOMContentLoaded', () => {
            GlobalConfig.initialize();
        });
    </script>

    <!-- Main Application Logic -->
    <script src="contract-flow-optimized.js"></script>

</body>
</html>
